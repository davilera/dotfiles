#!/bin/bash

if [ ! -f docker-compose.yml ];
then
	echo "The current directory doesn't contain a docker-compose.yml file" >&2
	exit 1
fi

if [ $# -ne 1 ];
then
	echo "Usage: initwp [SITE NAME]"
	exit 2
fi

URL=`grep VIRTUAL_HOST docker-compose.yml | cut -d: -f2 | awk '{$1=$1;print}'`
SITE=`echo "$1" | awk '{$1=$1;print}'`

docker-compose exec wordpress wp core install --url=$URL --admin_user=admin --admin_password=password --admin_email=admin@$URL --title="$SITE"
docker-compose exec wordpress wp core update
docker-compose exec wordpress wp plugin delete akismet hello
docker-compose exec wordpress wp theme activate twentynineteen
docker-compose exec wordpress wp theme delete twentyfifteen twentysixteen twentyseventeen


# Activate current plugin or theme

volume=`grep volumes -A 1 docker-compose.yml | tail -n1`

if [ `echo "$volume" | grep "wp-content/plugins" | wc -l` -eq 1 ];
then
	plugin=`echo "$volume" | cut -d: -f2`
	plugin=`basename "$plugin"`
	docker-compose exec wordpress wp plugin activate $plugin
fi

if [ `echo "$volume" | grep "wp-content/themes" | wc -l` -eq 1 ];
then
	theme=`echo "$volume" | cut -d: -f2`
	theme=`basename "$theme"`
	docker-compose exec wordpress wp theme activate $theme
fi
